# Архитектура приложения

## Обзор

Приложение построено на принципах модульной архитектуры с разделением ответственности между слоями.

```
┌─────────────────────────────────────────────────────┐
│                    UI Layer                         │
│  ┌─────────────────────────────────────────────┐   │
│  │              Pages (Страницы)                │   │
│  └─────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────┐   │
│  │          Components (Компоненты)             │   │
│  └─────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────┤
│                  State Layer                        │
│  ┌──────────────┐  ┌────────────────────────────┐  │
│  │    Zustand   │  │     TanStack Query         │  │
│  │  (Auth Store)│  │  (Server State Cache)      │  │
│  └──────────────┘  └────────────────────────────┘  │
├─────────────────────────────────────────────────────┤
│                   API Layer                         │
│  ┌─────────────────────────────────────────────┐   │
│  │           Axios API Clients                  │   │
│  └─────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────┤
│                  Backend (FastAPI)                  │
└─────────────────────────────────────────────────────┘
```

## Структура проекта

```
src/
├── api/                    # API-слой
│   ├── client.ts          # Настройка Axios
│   ├── auth.ts            # API авторизации
│   ├── tours.ts           # API туров
│   ├── reservations.ts    # API бронирований
│   └── reviews.ts         # API отзывов
│
├── components/            # React-компоненты
│   ├── layout/           # Компоненты макета
│   │   ├── Header.tsx    # Шапка
│   │   ├── Footer.tsx    # Подвал
│   │   └── Layout.tsx    # Основной макет
│   ├── ui/               # UI-компоненты (shadcn)
│   └── PrivateRoute.tsx  # Защита маршрутов
│
├── pages/                 # Страницы приложения
│   ├── HomePage.tsx       # Главная
│   ├── LoginPage.tsx      # Вход
│   ├── RegisterPage.tsx   # Регистрация
│   ├── ProfilePage.tsx    # Профиль
│   ├── ToursPage.tsx      # Список туров
│   ├── TourDetailPage.tsx # Детали тура
│   ├── TourFormPage.tsx   # Форма тура
│   └── ReservationsPage.tsx # Бронирования
│
├── store/                 # Глобальное состояние
│   └── authStore.ts      # Состояние авторизации
│
├── types/                 # TypeScript-типы
│   └── index.ts          # Типы данных
│
├── lib/                   # Утилиты
│   └── utils.ts          # Вспомогательные функции
│
├── App.tsx               # Корневой компонент
├── main.tsx              # Точка входа
└── index.css             # Глобальные стили
```

## Управление состоянием

### Zustand (локальное состояние)

Используется для хранения данных авторизации:

```typescript
interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  login: (username, password) => Promise<void>;
  logout: () => void;
}
```

### TanStack Query (серверное состояние)

Используется для кэширования и синхронизации данных с сервером:

- Автоматическое кэширование
- Фоновое обновление данных
- Оптимистичные обновления
- Обработка ошибок

## Маршрутизация

### Публичные маршруты

| Маршрут | Страница | Описание |
|---------|----------|----------|
| `/` | HomePage | Главная страница |
| `/login` | LoginPage | Вход в систему |
| `/register` | RegisterPage | Регистрация |
| `/tours` | ToursPage | Список туров |
| `/tours/:id` | TourDetailPage | Детали тура |

### Защищённые маршруты

| Маршрут | Страница | Описание |
|---------|----------|----------|
| `/profile` | ProfilePage | Профиль пользователя |
| `/tours/new` | TourFormPage | Создание тура |
| `/tours/:id/edit` | TourFormPage | Редактирование тура |
| `/reservations` | ReservationsPage | Мои бронирования |

## Компоненты UI

Используется библиотека **shadcn/ui**, основанная на Radix UI:

- Button
- Card
- Input
- Dialog
- Select
- Badge
- Toast
- Avatar
- DropdownMenu

## Обработка ошибок

### API-ошибки

```typescript
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // Редирект на логин
    }
    return Promise.reject(error);
  }
);
```

### Уведомления

Используется система Toast для отображения уведомлений об успешных операциях и ошибках.
